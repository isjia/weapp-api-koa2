# 第10章 面向对象与MySQL in 查询

## 10-1 获取期刊点赞信息

改善服务器性能，优先考虑在前端做缓存，优先级高于服务器缓存（redis）。

```js
// 获取指定的期刊的点赞状态
router.get('/:type/:id/favor', new Auth().m, async (ctx, next) => {
  const v = await new ClassicValidator().validate(ctx);
  const id = v.get('path.id');
  const type = v.get('path.type');
  const art = await Art.getData(id, type);
  if (!art) {
    throw new NotFoundException();
  }
  const like = await Favor.userLikeIt(id, type, ctx.auth.uid);
  ctx.body = {
    fav_nums: art.fav_nums,
    like_status: like,
  }
})
```

## 10-2 修复上小节Type的问题

```js
// 类可以保存变量的状态

class Checker{
  constructor(type) {
    this.enumType = type;
  }
  check(vals) {
    let type = vals.body.type || vals.path.type;
    if (!type) {
      throw new Error('type是必须参数');
    }
    type = parseInt(type);
    if (!this.enumType.isThisType(type)) {
      throw new Error('type参数不合法');
    }
  }
}

// const checker = new Checker(ArtType);
// this.validateType = checker.check.bind(checker);
```

## 10-3 避免循环查询数据库
